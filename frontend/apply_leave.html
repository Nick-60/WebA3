<!-- 与 backend/src/main/resources/static/apply_leave.html 相同，用于预览与同步 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>提交请假 | Leave System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="hold-transition layout-top-nav">
<div class="wrapper">
  <nav class="main-header navbar navbar-expand navbar-white navbar-light"><div id="navMount"></div></nav>
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <h1>Submit Leave</h1>
      </div>
    </section>
    <section class="content">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8 col-xl-6">
            <div class="card u-card u-card-elevated">
              <div class="card-body">
                <form id="leaveForm">
              <div class="form-group">
                <label>Leave Type</label>
                <select id="leaveType" class="form-control" required>
                  <option value="ANNUAL">Annual Leave</option>
                  <option value="SICK">Sick Leave</option>
                  <option value="UNPAID">Unpaid Leave</option>
                  <option value="OTHER">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Start Date</label>
                <input type="date" id="startDate" class="form-control" required placeholder="YYYY-MM-DD">
              </div>
              <div class="form-group">
                <label>End Date</label>
                <input type="date" id="endDate" class="form-control" required placeholder="YYYY-MM-DD">
              </div>
              <div class="form-group">
                <label>Comment</label>
                <textarea id="comment" class="form-control" rows="3" placeholder="optional"></textarea>
              </div>
              <button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
    
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/nav.js"></script>
<script>
  (function ensureLogin() {
    if (!getToken()) {
      showError('Please sign in first');
      window.location.href = '/login.html';
    }
  })();

  const form = document.getElementById('leaveForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const dto = {
      leave_type: document.getElementById('leaveType').value,
      start_date: document.getElementById('startDate').value,
      end_date: document.getElementById('endDate').value,
      comment: document.getElementById('comment').value.trim(),
    };
    const btn = document.getElementById('submitBtn');
    try {
      await withButtonLoading(btn, async () => {
        const resp = await createLeaveRequest(dto);
        if (resp && resp.code === 0) {
          showSuccess('Submitted successfully. ID: ' + (resp.data && resp.data.id ? resp.data.id : ''));
          setTimeout(function(){ window.location.href = '/dashboard.html' }, 800);
        } else {
          showError(resp && resp.message ? resp.message : 'Submit failed');
        }
      });
    } catch (err) {
      showError('Submit failed: ' + ((err && err.response && err.response.data && err.response.data.message) ? err.response.data.message : err.message));
    }
  });
</script>
</body>
</html>
