<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>提交请假 | Leave System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <a class="navbar-brand" href="/dashboard.html">返回仪表盘</a>
  </nav>
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <h1>提交请假</h1>
      </div>
    </section>
    <section class="content">
      <div class="container-fluid">
        <div class="card">
          <div class="card-body">
            <form id="leaveForm">
              <div class="form-group">
                <label>请假类型</label>
                <select id="leaveType" class="form-control" required>
                  <option value="ANNUAL">年假</option>
                  <option value="SICK">病假</option>
                  <option value="CASUAL">事假</option>
                </select>
              </div>
              <div class="form-group">
                <label>开始日期</label>
                <input type="date" id="startDate" class="form-control" required>
              </div>
              <div class="form-group">
                <label>结束日期</label>
                <input type="date" id="endDate" class="form-control" required>
              </div>
              <div class="form-group">
                <label>备注</label>
                <textarea id="comment" class="form-control" rows="3" placeholder="可选"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">提交</button>
            </form>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
<script src="/js/ui.js"></script>
<script src="/js/config.js"></script>
<script src="/js/auth.js"></script>
<script>
  (function ensureLogin() {
    if (!getToken()) {
      showError('请先登录');
      window.location.href = '/login.html';
    }
  })();

  const form = document.getElementById('leaveForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const dto = {
      leave_type: document.getElementById('leaveType').value,
      start_date: document.getElementById('startDate').value,
      end_date: document.getElementById('endDate').value,
      comment: document.getElementById('comment').value.trim(),
    };
    try {
      const resp = await createLeaveRequest(dto);
      if (resp && resp.code === 0) {
        showSuccess('提交成功，单号：' + (resp.data?.id || '')); 
        // 跳转到仪表盘或保留当前页
        setTimeout(() => window.location.href = '/dashboard.html', 800);
      } else {
        showError(resp?.message || '提交失败');
      }
    } catch (err) {
      showError('提交失败：' + (err?.response?.data?.message || err.message));
    }
  });
</script>
</body>
</html>

